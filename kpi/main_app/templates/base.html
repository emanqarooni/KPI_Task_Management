{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/output.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/auth.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <title>KPI Dashboard</title>
  </head>

  <body>
    <div class="layout-body">
      <div class="flex">
        <aside
          id="sidebar"
          class="sidebar-purple sidebar-collapsed min-h-screen flex flex-col items-center py-6"
        >
          <!-- Hamburger Menu Toggle -->
          <button
            id="sidebar-toggle"
            class="btn btn-ghost btn-square text-white hover:bg-white/20 mb-6"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>



          <!-- Dashboard Link -->
          <a
            href="{% url 'dashboard' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="Dashboards"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Dashboards</span>
          </a>

          <!-- Admin Section -->
          {% if user.employeeprofile.role == 'admin' %}
          <a
            href="{% url 'index' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="View KPIs"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">View KPIs</span>
          </a>
          <a
            href="{% url 'admin_reports' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="View KPIs"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Reports</span>
          </a>

          <a
            href="{% url 'activity_logs' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="Activity Logs"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 013-3h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Activity Logs</span>
          </a>
          {% endif %}

          <!-- Manager Section -->
          {% if user.employeeprofile and user.employeeprofile.role == 'manager' %}
          <a
            href="{% url 'employee_kpi_list' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="Assign KPI"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Assignments</span>
          </a>

          <a
            href="{% url 'reports' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="Assign KPI"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Reports</span>
          </a>
          {% endif %}

          <!-- Employee Section -->
          {% if user.employeeprofile.role == 'employee' %}
          <a
            href="{% url 'progress' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="Add Progress"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">Add Progress</span>
          </a>
          <a
            href="{% url 'employee_kpi' %}"
            class="btn btn-ghost hover:bg-white/20 mb-4 text-white flex items-center justify-start w-full px-4"
            title="My KPIs"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 flex-shrink-0"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 013-3h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <span class="sidebar-text ml-3 text-lg">My KPIs</span>
          </a>
          {% endif %}
        </aside>

        <!-- Backdrop overlay for mobile -->
        <div id="sidebar-backdrop" class="sidebar-backdrop"></div>

        <!-- Main Content Wrapper -->
        <div class="flex-1 flex flex-col" id="main-content">
          <!-- Top Navbar -->
          <header class="navbar bg-base-100 border-b border-base-300">
            <!-- Brand/Title -->
            <div class="flex-1 px-4">
              <div>
                <h1 class="text-xl font-bold">SEEF</h1>
                <h2 class="text-sm text-base-content/70">
                  {% if user.employeeprofile.role == 'manager' %} Manager Portal
                  {% elif user.employeeprofile.role == 'admin' %} Admin Portal
                  {% elif user.employeeprofile.role == 'employee' %} Employee Portal
                  {% else %} Portal {% endif %}
                </h2>
              </div>
            </div>

            <!-- Right side -->
            <div class="flex-none gap-2">
              {% if user.is_authenticated and user.employeeprofile.role != 'admin' %}
              <a href="{% url 'notifications' %}">
                <div class="dropdown dropdown-end">
                  <label tabindex="0" class="btn btn-ghost btn-circle">
                    <div class="indicator">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                        />
                      </svg>
                      {% if unread_notifications_count > 0 %}
                      <span class="badge badge-sm badge-primary indicator-item">
                        {{ unread_notifications_count }}
                      </span>
                      {% endif %}
                    </div>
                  </label>
                </div>
              </a>
              {% endif %}

              {% if user.is_authenticated %}
              <!-- Profile Dropdown -->
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-circle avatar">
                  <div
                    class="w-10 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2"
                  >
                    <img src="{{ user.employeeprofile.image.url }}" alt="{{ user.username }}" />
                  </div>
                </label>
                <ul
                  tabindex="0"
                  class="dropdown-content menu p-2 shadow-lg bg-base-100 rounded-box w-52 mt-3 border border-base-300"
                >
                  <li>
                    <a
                      href="{% url 'profile' %}"
                      class="flex items-center gap-2 py-3"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                        />
                      </svg>
                      Profile
                    </a>
                  </li>
                  <li>
                    <form action="{% url 'logout' %}" method="post" class="w-full">
                      {% csrf_token %}
                      <button
                        type="submit"
                        class="flex items-center gap-2 py-3 w-full text-left"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                          />
                        </svg>
                        Logout
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
              {% else %}
              <a href="{% url 'login' %}" class="btn btn-primary btn-sm">Login</a>
              {% endif %}
            </div>
          </header>

          <!-- Main Content Area -->
          <main class="flex-1 p-6 bg-base-200 min-h-screen">
            <div class="container mx-auto">
              {% block content %}{% endblock %}
            </div>
          </main>
        </div>
      </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const sidebar = document.getElementById("sidebar")
  const sidebarToggle = document.getElementById("sidebar-toggle")
  const mainContent = document.getElementById("main-content")
  const backdrop = document.getElementById("sidebar-backdrop")

  sidebarToggle.addEventListener("click", (e) => {
    e.stopPropagation();
    sidebar.classList.toggle("sidebar-collapsed")
    sidebar.classList.toggle("sidebar-expanded")
    backdrop.classList.toggle("active")
  })

  backdrop.addEventListener("click", () => {
    sidebar.classList.remove("sidebar-expanded")
    sidebar.classList.add("sidebar-collapsed")
    backdrop.classList.remove("active");
  });

  document.addEventListener("keydown", (e) => {
    if (
      e.key === "Escape" &&
      sidebar.classList.contains("sidebar-expanded")
    ) {
      sidebar.classList.remove("sidebar-expanded")
      sidebar.classList.add("sidebar-collapsed")
      backdrop.classList.remove("active")
    }
  });

  const currentPath = window.location.pathname;
  const menuLinks = document.querySelectorAll("aside a");

  menuLinks.forEach((link) => {
    if (link.getAttribute("href") === currentPath) {
      link.classList.add("bg-white/30");
    }
  })
})
</script>

    </div>
  </body>
</html>
