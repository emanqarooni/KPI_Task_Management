{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="dashboard-container">

  <div class="dashboard-content">

    <h2>Manager Dashboard</h2>
    <p>Manager: {{ manager_name }}</p>
    <p>Department: {{ department }}</p>
    <p>Total Employees: {{ employees_count }}</p>

    <h3>Team KPI Summary</h3>

    <table>
      <tr>
        <th>Employee</th>
        <th>KPI Completion</th>
        <th>Status</th>
      </tr>
      {% for row in employee_rows %}
      <tr>
        <td>{{ row.name }}</td>
        <td>{{ row.completion }}%</td>
        <td>{{ row.status }}</td>
      </tr>
      {% endfor %}
    </table>

    <div class="kpi-box">
      <canvas id="managerChart"></canvas>
    </div>

  </div>
</div>

<div>
  <a href="{% url 'ai_kpi_insights' %}" class="btn blue">
    Generate AI KPI Insights
  </a>
</div>
<script>
const managerData = {{ employee_rows|safe }};

const managerLabels = managerData.map(item => item.name);
const managerValues = managerData.map(item => item.completion);

new Chart(document.getElementById("managerChart"), {
    type: "bar",
    data: {
        labels: managerLabels,
        datasets: [{
            label: "Team KPI Completion (%)",
            data: managerValues,
            borderWidth: 1
        }]
    }
});
</script>

{% endblock %}
