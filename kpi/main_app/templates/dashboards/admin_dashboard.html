{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="dashboard-container">
  <a href="{% url 'ai_admin_insights' %}" class="btn blue">AI Organizational Insights</a>

  <div class="dashboard-content">

    <h2>Admin Dashboard</h2>

    <div class="kpi-box">
      <p>Total Users: <strong>{{ total_users }}</strong></p>
      <p>Total Employees: <strong>{{ total_employees }}</strong></p>
    </div>

    <h3>Employee KPI Assignments</h3>

    <div class="admin-table-container">
      <table class="table table-zebra admin-kpi-table">
        <thead>
          <tr class="admin-table-header">
            <th>Employee</th>
            <th>Manager</th>
            <th>KPI</th>
            <th>Target</th>
            <th>Progress</th>
            <th>Weight</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for data in employee_kpi_data %}
          <tr class="admin-table-row">
            <td class="employee-name-cell">{{ data.employee_name }}</td>
            <td class="manager-name-cell">{{ data.manager_name }}</td>
            <td class="kpi-title-cell">{{ data.kpi_title }}</td>
            <td class="target-cell">{{ data.target_value }}</td>
            <td class="progress-cell">
              <div class="progress-info">
                <span class="progress-value">{{ data.current_progress }} / {{ data.target_value }}</span>
                <span class="progress-percentage">({{ data.progress_percentage }}%)</span>
              </div>
            </td>
            <td class="weight-cell">{{ data.weight }}%</td>
            <td class="status-cell">
              <span class="badge
                {% if data.status == 'Complete' %}badge-status-complete
                {% elif data.status == 'In Progress' %}badge-status-progress
                {% else %}badge-status-none{% endif %}">
                {{ data.status }}
              </span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="empty-state-cell">No KPI assignments found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h3>KPI Overview Chart</h3>

    <div class="kpi-box">
      <canvas id="adminChart"></canvas>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('adminChart');
    if (ctx) {
        const adminLabels = {{ chart_labels|safe }};
        const adminValues = {{ chart_values|safe }};

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: adminLabels,
                datasets: [{
                    data: adminValues,
                    backgroundColor: [
                        '#3B82F6',
                        '#10B981',
                        '#F59E0B',
                        '#EF4444',
                        '#8B5CF6',
                        '#EC4899'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
});
</script>

{% endblock %}
